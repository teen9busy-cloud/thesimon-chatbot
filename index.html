<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë”ì‹¬ì˜¨ - ì†Œë°© ìƒë‹´</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.png">
    <style>
        :root { --main: #007bff; --bg: #f5f7fb; --txt: 19px; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        #login-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; background: #fff; padding: 25px; }
        #login-screen input { width: 90%; padding: 16px; margin: 10px 0; border: 1px solid #ddd; border-radius: 12px; font-size: var(--txt); }
        #login-screen button { width: 95%; padding: 16px; background: var(--main); color: #fff; border: none; border-radius: 12px; font-size: 18px; font-weight: bold; }

        #chat-screen { display: none; flex-direction: column; height: 100%; }
        header { background: var(--main); color: #fff; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; font-size: 19px; font-weight: bold; }
        
        #chat-window { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        
        /* ë„ì–´ì“°ê¸° í•´ê²° í¬ì¸íŠ¸ */
        .message { 
            max-width: 80%; padding: 12px 16px; border-radius: 18px; 
            font-size: var(--txt); line-height: 1.6; 
            white-space: pre-wrap; /* ê³µë°± ë° ì¤„ë°”ê¿ˆ ë³´ì¡´ */
            word-break: keep-all; word-wrap: break-word; 
        }
        .user { align-self: flex-end; background: var(--main); color: #fff; }
        .bot { align-self: flex-start; background: #fff; color: #333; border: 1px solid #eee; }

        /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ (...) */
        .typing-dots span { display: inline-block; width: 6px; height: 6px; background: #999; border-radius: 50%; margin-right: 3px; animation: bounce 1.4s infinite; }
        @keyframes bounce { 0%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(-6px); } }

        /* ì…ë ¥ì°½ ë””ìì¸ */
        #input-area { padding: 12px; background: #fff; display: flex; align-items: flex-end; gap: 10px; border-top: 1px solid #eee; }
        #user-input { flex: 1; border: 1px solid #ddd; border-radius: 20px; padding: 12px 16px; font-size: var(--txt); resize: none; max-height: 120px; outline: none; }
        
        /* ë§ˆì´í¬ ë…¹ìŒ ì¤‘ í‘œì‹œ */
        #mic-btn.active { color: red; animation: blink 1s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }

        /* ì¹´í†¡ ìŠ¤íƒ€ì¼ ì „ì†¡ ë²„íŠ¼ */
        #send-btn { background: var(--main); width: 45px; height: 45px; border-radius: 50%; border: none; display: flex; align-items: center; justify-content: center; padding: 0; }
        #send-btn svg { width: 22px; height: 22px; fill: white; transform: translateX(2px); }
    </style>
</head>
<body>

<div id="login-screen">
    <h2>ë”ì‹¬ì˜¨ ì†Œë°©ìƒë‹´</h2>
    <input type="text" id="userName" placeholder="ì„±í•¨">
    <input type="number" id="userPhone" placeholder="ì „í™”ë²ˆí˜¸ ë’·ìë¦¬(4ìë¦¬)">
    <button onclick="startChat()">ìƒë‹´ ì‹œì‘í•˜ê¸°</button>
</div>

<div id="chat-screen">
    <header><span>ë”ì‹¬ì˜¨</span><button id="end-btn" onclick="endChat()" style="background:none; border:1px solid #fff; color:#fff; border-radius:15px; padding:5px 10px;">ì¢…ë£Œ</button></header>
    <div id="chat-window"></div>
    <div id="input-area">
        <button id="mic-btn" onclick="startVoice()" style="background:none; border:none; font-size:24px;">ğŸ™ï¸</button>
        <textarea id="user-input" rows="1" placeholder="ë©”ì‹œì§€ ì…ë ¥..." oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px'"></textarea>
        <button id="send-btn" onclick="sendMessage()">
            <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
        </button>
    </div>
</div>

<script>
    const GAS_URL = "ì—¬ê¸°ì—_ìƒˆ_ë°°í¬_URL_ì…ë ¥";
    let userId = "";

    function startChat() {
        const n = document.getElementById('userName').value;
        const p = document.getElementById('userPhone').value;
        if(n && p.length===4) {
            userId = n + "_" + p;
            document.getElementById('login-screen').style.display='none';
            document.getElementById('chat-screen').style.display='flex';
            typeWriter("ë°˜ê°‘ìŠµë‹ˆë‹¤, ëŒ€ì›ë‹˜. ì˜¤ëŠ˜ í•˜ë£¨ëŠ” ì–´ë– ì…¨ë‚˜ìš”?");
        }
    }

    async function sendMessage() {
        const input = document.getElementById('user-input');
        const msg = input.value.trim();
        if(!msg) return;
        addMessage(msg, 'user');
        input.value=''; input.style.height='auto';
        
        const loaderId = addLoader();
        try {
            const res = await fetch(GAS_URL, { method:'POST', body: JSON.stringify({ userId, message: msg }) });
            const data = await res.json();
            document.getElementById(loaderId).remove();
            typeWriter(data.reply);
        } catch(e) { document.getElementById(loaderId).innerText="ì˜¤ë¥˜ ë°œìƒ"; }
    }

    function addMessage(t, s) {
        const win = document.getElementById('chat-window');
        const div = document.createElement('div');
        div.className = 'message ' + s;
        div.innerText = t;
        win.appendChild(div);
        win.scrollTop = win.scrollHeight;
    }

    function typeWriter(t) {
        const win = document.getElementById('chat-window');
        const div = document.createElement('div');
        div.className = 'message bot';
        win.appendChild(div);
        let i = 0;
        function play() {
            if(i < t.length) { div.innerText += t.charAt(i); i++; win.scrollTop = win.scrollHeight; setTimeout(play, 35); }
        }
        play();
    }

    function addLoader() {
        const id = 'ld-'+Date.now();
        const win = document.getElementById('chat-window');
        const div = document.createElement('div');
        div.className = 'message bot'; div.id = id;
        div.innerHTML = '<div class="typing-dots"><span></span><span></span><span></span></div>';
        win.appendChild(div); win.scrollTop = win.scrollHeight;
        return id;
    }

    function startVoice() {
        const rec = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        rec.lang = 'ko-KR';
        rec.onstart = () => document.getElementById('mic-btn').classList.add('active');
        rec.onend = () => document.getElementById('mic-btn').classList.remove('active');
        rec.onresult = (e) => { 
            document.getElementById('user-input').value = e.results[0][0].transcript; 
            document.getElementById('user-input').dispatchEvent(new Event('input'));
        };
        rec.start();
    }

    async function endChat() { if(confirm("ì¢…ë£Œí• ê¹Œìš”?")) location.reload(); }
</script>
</body>
</html>
